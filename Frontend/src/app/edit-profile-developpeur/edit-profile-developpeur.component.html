<div class="container">
  <div class="card">
    <div class="card-header">
      <h2><i class="fas fa-user-cog me-2"></i>Profil Développeur</h2>
    </div>

    <div class="card-body">
      <div class="row">
        <!-- Colonne de formulaire -->
        <div class="col-md-8">
          <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" novalidate>
            <!-- Section Informations personnelles -->
            <div class="personal-section">
              <div class="section-header">
                <h5><i class="fas fa-user me-2"></i>Informations Personnelles</h5>
              </div>

              <div class="card-body">
                <div class="form-group">
                  <label class="form-label">Nom d'utilisateur</label>
                  <input formControlName="username" class="form-control" type="text">
                  <div *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched" 
                       class="invalid-feedback">
                    Le nom d'utilisateur est requis (minimum 3 caractères)
                  </div>
                </div>


                <div class="form-group">
                  <label class="form-label">Email</label>
                  <input formControlName="email" class="form-control" type="email">
                  <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" 
                       class="invalid-feedback">
                    Adresse email invalide
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Spécialité</label>
                  <input formControlName="specialite" class="form-control" type="text">
                  <div *ngIf="profileForm.get('specialite')?.invalid && profileForm.get('specialite')?.touched" 
                       class="invalid-feedback">
                    La spécialité est requise
                  </div>
                </div>

                <!-- Champ Technologies -->
                <div class="form-group">
                  <label class="form-label">Technologies</label>
                  <select class="form-select" multiple formControlName="technologies">
                    <option *ngFor="let tech of technologiesOptions" [value]="tech">{{ tech }}</option>
                  </select>
                  <div *ngIf="profileForm.get('technologies')?.invalid && profileForm.get('technologies')?.touched" 
                       class="invalid-feedback">
                    Veuillez sélectionner au moins une technologie
                  </div>
                </div>

                <!-- Champ Expérience -->
                <div class="form-group">
                  <label class="form-label">Années d'expérience</label>
                  <input formControlName="experience" class="form-control" type="number" min="0">
                  <div *ngIf="profileForm.get('experience')?.invalid && profileForm.get('experience')?.touched" 
                       class="invalid-feedback">
                    Doit être un nombre positif
                  </div>
                </div>

                <!-- Champ Score (readonly) -->
                <div class="form-group">
                  <label class="form-label">Score</label>
                  <input formControlName="score" class="form-control" type="number" readonly>
                </div>
              </div>
            </div>

            <!-- Section Sécurité -->
            <div class="security-section">
              <div class="section-header">
                <h5><i class="fas fa-shield-alt me-2"></i>Sécurité</h5>
              </div>

              <div class="card-body">
                <div class="form-group password-field">
                  <label class="form-label">Ancien mot de passe</label>
                  <input formControlName="oldPassword" 
                         class="form-control" 
                         [type]="showOldPassword ? 'text' : 'password'">
                  <i class="fas {{showOldPassword ? 'fa-eye-slash' : 'fa-eye'}} toggle-password" 
                     (click)="showOldPassword = !showOldPassword"></i>
                </div>

                <div class="form-group password-field">
                  <label class="form-label">Nouveau mot de passe</label>
                  <input formControlName="newPassword" 
                         class="form-control" 
                         [type]="showNewPassword ? 'text' : 'password'">
                  <i class="fas {{showNewPassword ? 'fa-eye-slash' : 'fa-eye'}} toggle-password" 
                     (click)="showNewPassword = !showNewPassword"></i>
                  <div *ngIf="profileForm.get('newPassword')?.invalid && profileForm.get('newPassword')?.touched" 
                       class="invalid-feedback">
                    Minimum 6 caractères requis
                  </div>
                </div>

                <button class="btn btn-primary" 
                        type="button"
                        (click)="updatePassword()"
                        [disabled]="!profileForm.get('oldPassword')?.value || !profileForm.get('newPassword')?.valid">
                  <i class="fas fa-save me-1"></i> Mettre à jour le mot de passe
                </button>
              </div>
            </div>

            <!-- Boutons d'action -->
            <div class="action-buttons">
              <button class="btn btn-outline-secondary" type="button" (click)="cancel()">
                <i class="fas fa-times me-2"></i> Annuler
              </button>
              <button class="btn btn-primary" 
                      type="submit" 
                      [disabled]="profileForm.invalid || isLoading">
                <i class="fas fa-save me-2"></i> 
                <span *ngIf="!isLoading">Enregistrer</span>
                <span *ngIf="isLoading">Enregistrement...</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Colonne photo -->
        <div class="col-md-4 text-center">
          <div class="photo-container">
            <img [src]="selectedPhoto || devPhoto" 
                 alt="Photo de profil" 
                 class="profile-photo">
            <label class="btn-change-photo" title="Changer la photo">
              <i class="fas fa-camera"></i>
              <input type="file" class="file-input"
                     (change)="onFileSelected($event)" 
                     accept="image/*">
            </label>
          </div>

          <small class="text-muted d-block mt-2">Formats supportés: JPG, PNG (max 2MB)</small>

          <button *ngIf="selectedPhoto" 
                  class="btn btn-primary mt-3"
                  (click)="updatePhoto()"
                  [disabled]="isLoading">
            <i class="fas fa-save me-1"></i> Enregistrer la photo
          </button>
        </div>
      </div>
    </div>
  </div>
</div>